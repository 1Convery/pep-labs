# JDBC Walkthrough

JDBC stands for Java DataBase Connnectivity. It is utilized to connect our java code with a database. JDBC will allow us to execute SQL statements from java and retrieve the result set of that query to be utilized in java.

## JDBC classes to know:
- **Connection**: Creates an active connection to a database
- **Statement**: An object that represents a SQL statement to be executed.
- **ResultSet**: An object that represents the virtual table that will be returned from the sql query (Only needed for DQL statements)

## Demo
### Background
The best way to see how these jdbc classes to work together is to see an example.

Lets assume we have the following database table called "users".

| id    | firstname | lastname |	       	    
|:------|-----------|----------|
| **1** | Let it be | Beatles  |          
| **2** | Imagine   | Beatles  |   

### Objective
The objective of this walkthrough is to utilize JDBC logic to do the following:
- create a new record in the user table from java 
- retrieve all records from the users table from java

### Step 1: Create a User model that directly matches the sql table.
Since we are going to be query a sql table that represents a user, we need to create a class that represents a user.

```java
public class User{
    
    // notice that the fields in this class directly match the columns in the SQL table above
    private int id;
    private String firstname;
    private String lastname;
    
    // The methods you would have in this class would be the following:
    //  - constructors
    //  - getters and setters 
    //  - hashcode and equals
    //  - toString
    //     
    // Note: All the methods stated above can be autogenerated through your IDE.
}
```

### Step 2: Create a Class that will execute our JDBC logic.
This class is usually named one of the following:
- UserDao (DAO stands for Data Access Object)
- UserRepository

```java
public class UserDao{
    //we will write jdbc logic in this method to create a new user record in the table
    public void createUser(User user){
        
    }
    
    //we will write jdbc logic in this method to retrieve all records that are in the users table
    public List<User> getAllUsers(){
        
    }
}
```

### Step 3: Write the JDBC logic inside of the createUser method

```java
import Util.ConnectionUtil;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;

public class UserDao {
    //we will write jdbc logic in this method to create a new user record in the table
    public void createUser(User user) {
        //a try catch is needed due to the potential to write incorrect SQL syntax.
        try {
            //Connection represents an active connection to the database
            Connection connection = ConnectionUtil.getConnection();

            //This will be the object that executes the statement
            Statement statement = connection.createStatement();
            //Storing the SQL statement into a string. We are dynamically adding the firstname and lastname from the user object that was passed to us in the method.
            String sql = "INSERT INTO users (firstname, lastname) VALUES ('" + user.getFirstname() + "','" + user.getLastname() + "');";

            //execute the statement
            statement.executeUpdate(sql);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
    public List<User> getAllUsers() { }
}
```


### Step 4: Write the JDBC logic inside of the getAllUsers method

```java
import SQL_Basic.DQL._6_SELECTING_SPECIFIC_COLUMNS.User;
import Util.ConnectionUtil;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;

public class UserDao {
    public void createUser(User user) {
        try {
            Connection connection = ConnectionUtil.getConnection();
            Statement statement = connection.createStatement();
            String sql = "INSERT INTO users (firstname, lastname) VALUES ('" + user.getFirstname() + "','" + user.getLastname() + "');";

            statement.executeUpdate(sql);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }

    //we will write jdbc logic in this method to retrieve all records that are in the users table
    public List<User> getAllUsers() {

        //this will be the variable that we will start storing user objects into once we get the data from the database.
        List<User> users = new ArrayList<>();

        //a try catch is needed due to the potential to write incorrect SQL syntax.
        try {
            //Connection represents an active connection to the database
            Connection connection = ConnectionUtil.getConnection();

            //This will be the object that executes the statement
            Statement statement = connection.createStatement();
            //Storing the SQL statement into a string. We are dynamically adding the firstname and lastname from the user object that was passed to us in the method.
            String sql = "INSERT INTO users (firstname, lastname) VALUES ('" + user.getFirstname() + "','" + user.getLastname() + "');";

            //For DQL statements, we utilize the method executeQuery instead. ExecuteQuery returns a ResultSet object which we can loop through and retrieve all of the records from the table.
            ResultSet resultSet = statement.executeQuery(sql);

            //loop through the records
            while (resultSet.next()) {
                User user = new User();
                //the number inside the getter methods of the result set represents the column from the table we are trying to store here. 
                //the first column starts at 1 NOT 0.
                user.setId(resultSet.getInt(1));
                user.setFirstname(resultSet.getString(2));
                user.setLastname(resultSet.getString(3));

                //add the user object to the users list variable above
                users.add(user);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }

        //return the list of users when loop finishes
        return users;
    }
}
```

### Step 5: Your'e done! 
If done correctly, we have now created 2 methods that we can reuse to create new users in our database from java and query all the users from our database from java.

Note: 
- Anytime you need to execute a DDL or DML statement, you will use similar logic from step 3.
- Anytime you need to execute a DQL statement, you will use similar logic from step 4.

